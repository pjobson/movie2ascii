<!DOCTYPE html>
<html>
<head>
<title>__TITLE__</title>
<script src="assets/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="assets/cssreset.min.css" />
<style type="text/css">

</style>
</head>
<body>
<audio id="audio" controls="controls">
	<source src="mp3/audio.mp3" type="audio/mpeg">
</audio>
<pre id="movie">CLICK PLAY</pre>

<script type="text/javascript">
// This is kind of a giant piece of crap
// Files are as such: img.0000000000.txt
var counter = {
	frame: 1,
	last: __LAST_FRAME__,
	fps: __FPS__,
	timeout: 0
};

counter.timeout = counter.last/counter.fps;

// play is called when play button is pressed or after seeking
// seeked doesn't work in chrome for some reason, so i use this instead.
$('#audio').bind('play', function(ev) {
	var el = ev.currentTarget;
	var curSec = parseInt(el.currentTime,10);
	// set current time to nearest interger, mainly to simplify guessing the frame.
	el.currentTime = curSec;

	// get aproximate frame, probably as close as I can get it.
	counter.frame = parseInt((counter.last / counter.fps) * curSec,10) + 1;

	startMovie();
});

$('#audio').bind('pause', function(ev) {
	stopMovie();
});

var startMovie = function() {
	window.timer = window.setInterval(function() {
		console.log('frame');
	}, counter.timeout);
};

var stopMovie = function() {

};



// var getFrame = function() {
// 	var iter = iterate();
// 	if (iter === false) {
// 		stopMovie();
// 		return;
// 	}
// 	$.ajax({
// 		url: 'txt/img.'+ iter +'.txt',
// 		success: function(res) {
// 			$('#movie').html(res);
// 		}
// 	});
// }

// var stopMovie = function() {
// 	window.clearInterval(window.timer);
// };

// var startMovie = function() {
// 	window.timer = window.setInterval(function() {
// 		if (iterate !== false) {
// 			getFrame();
// 		} else {
// 			stopMovie();
// 		}
// 	},(1000/counter.fps));
// };


</script>
</body>
</html>


